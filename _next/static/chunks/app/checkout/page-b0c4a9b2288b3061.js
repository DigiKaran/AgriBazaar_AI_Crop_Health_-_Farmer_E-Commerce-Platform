(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8279],{5323:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>i,_:()=>n});var s=r(95155),a=r(12115);let l=(0,a.createContext)(void 0),n=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e},i=e=>{let{children:t}=e,[r,n]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=localStorage.getItem("agriBazaarCart");e&&n(JSON.parse(e))},[]),(0,a.useEffect)(()=>{localStorage.setItem("agriBazaarCart",JSON.stringify(r))},[r]);let i=e=>{n(t=>t.filter(t=>t.id!==e))},d=(0,a.useMemo)(()=>r.reduce((e,t)=>e+t.quantity,0),[r]),o=(0,a.useMemo)(()=>r.reduce((e,t)=>e+t.price*t.quantity,0),[r]);return(0,s.jsx)(l.Provider,{value:{cartItems:r,addToCart:e=>{n(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},removeFromCart:i,updateQuantity:(e,t)=>{t<=0?i(e):n(r=>r.map(r=>r.id===e?{...r,quantity:t}:r))},clearCart:()=>{n([])},cartCount:d,cartTotal:o},children:t})}},6654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return a}});let s=r(12115);function a(e,t){let r=(0,s.useRef)(null),a=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let e=r.current;e&&(r.current=null,e());let t=a.current;t&&(a.current=null,t())}else e&&(r.current=l(e,s)),t&&(a.current=l(t,s))},[e,t])}function l(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},17759:(e,t,r)=>{"use strict";r.d(t,{C5:()=>g,MJ:()=>h,Rr:()=>j,eI:()=>x,lR:()=>p,lV:()=>o,zB:()=>u});var s=r(95155),a=r(12115),l=r(99708),n=r(62177),i=r(59434),d=r(85057);let o=n.Op,c=a.createContext({}),u=e=>{let{...t}=e;return(0,s.jsx)(c.Provider,{value:{name:t.name},children:(0,s.jsx)(n.xI,{...t})})},m=()=>{let e=a.useContext(c),t=a.useContext(f),{getFieldState:r,formState:s}=(0,n.xW)(),l=r(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...l}},f=a.createContext({}),x=a.forwardRef((e,t)=>{let{className:r,...l}=e,n=a.useId();return(0,s.jsx)(f.Provider,{value:{id:n},children:(0,s.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",r),...l})})});x.displayName="FormItem";let p=a.forwardRef((e,t)=>{let{className:r,...a}=e,{error:l,formItemId:n}=m();return(0,s.jsx)(d.J,{ref:t,className:(0,i.cn)(l&&"text-destructive",r),htmlFor:n,...a})});p.displayName="FormLabel";let h=a.forwardRef((e,t)=>{let{...r}=e,{error:a,formItemId:n,formDescriptionId:i,formMessageId:d}=m();return(0,s.jsx)(l.DX,{ref:t,id:n,"aria-describedby":a?"".concat(i," ").concat(d):"".concat(i),"aria-invalid":!!a,...r})});h.displayName="FormControl";let j=a.forwardRef((e,t)=>{let{className:r,...a}=e,{formDescriptionId:l}=m();return(0,s.jsx)("p",{ref:t,id:l,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})});j.displayName="FormDescription";let g=a.forwardRef((e,t)=>{var r;let{className:a,children:l,...n}=e,{error:d,formMessageId:o}=m(),c=d?String(null!=(r=null==d?void 0:d.message)?r:""):l;return c?(0,s.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",a),...n,children:c}):null});g.displayName="FormMessage"},29301:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(95155),a=r(12115),l=r(35695),n=r(62177),i=r(90221),d=r(55594),o=r(40283),c=r(5323),u=r(30285),m=r(62523),f=r(66695),x=r(17759),p=r(91840),h=r(87481),j=r(66766),g=r(46339);let y=d.Ik({fullName:d.Yj().min(3,"Full name must be at least 3 characters"),phone:d.Yj().min(10,"Please enter a valid 10-digit phone number").max(10),addressLine1:d.Yj().min(5,"Address is too short"),addressLine2:d.Yj().optional(),city:d.Yj().min(2,"City name is required"),state:d.Yj().min(2,"State name is required"),pincode:d.Yj().min(6,"Please enter a valid 6-digit PIN code").max(6)});function v(){let e=(0,l.useRouter)(),{currentUser:t,userProfile:r,loading:d}=(0,o.A)(),{cartItems:v,cartTotal:N,clearCart:b}=(0,c._)(),{toast:w}=(0,h.dj)(),C=(0,n.mN)({resolver:(0,i.u)(y),defaultValues:{fullName:"",phone:"",addressLine1:"",addressLine2:"",city:"",state:"",pincode:""}});(0,a.useEffect)(()=>{r&&C.setValue("fullName",r.displayName||"")},[r,C]);let{formState:{isSubmitting:S}}=C;(0,a.useEffect)(()=>{d||t||e.push("/login?redirect=/checkout"),d||0!==v.length||e.push("/products")},[d,t,v,e]);let I=async r=>{if(!t)return void w({variant:"destructive",title:"Error",description:"You must be logged in to place an order."});let s=await (0,p.qd)({userId:t.uid,items:v,totalAmount:N,shippingAddress:r});s.success&&s.orderId?(w({title:"Order Placed Successfully!",description:"Your order #".concat(s.orderId," has been confirmed.")}),b(),e.push("/profile")):w({variant:"destructive",title:"Order Failed",description:s.error||"There was a problem placing your order."})};return d||!t||0===v.length?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-10rem)]",children:(0,s.jsx)(g.G,{size:48})}):(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,s.jsxs)("header",{className:"mb-8 text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-headline",children:"Checkout"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Please provide your shipping details to complete the order."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-12",children:[(0,s.jsx)("div",{className:"lg:col-span-3",children:(0,s.jsxs)(f.Zp,{className:"shadow-lg rounded-xl",children:[(0,s.jsx)(f.aR,{children:(0,s.jsx)(f.ZB,{children:"Shipping Information"})}),(0,s.jsx)(f.Wu,{children:(0,s.jsx)(x.lV,{...C,children:(0,s.jsxs)("form",{onSubmit:C.handleSubmit(I),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,s.jsx)(x.zB,{control:C.control,name:"fullName",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"Full Name"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{placeholder:"Your full name",...t})}),(0,s.jsx)(x.C5,{})]})}}),(0,s.jsx)(x.zB,{control:C.control,name:"phone",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"Phone Number"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{type:"tel",placeholder:"10-digit mobile number",...t})}),(0,s.jsx)(x.C5,{})]})}})]}),(0,s.jsx)(x.zB,{control:C.control,name:"addressLine1",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"Address Line 1"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{placeholder:"House No., Building, Street",...t})}),(0,s.jsx)(x.C5,{})]})}}),(0,s.jsx)(x.zB,{control:C.control,name:"addressLine2",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"Address Line 2 (Optional)"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{placeholder:"Apartment, suite, landmark, etc.",...t})}),(0,s.jsx)(x.C5,{})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[(0,s.jsx)(x.zB,{control:C.control,name:"city",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"City"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{placeholder:"e.g., Mumbai",...t})}),(0,s.jsx)(x.C5,{})]})}}),(0,s.jsx)(x.zB,{control:C.control,name:"state",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"State"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{placeholder:"e.g., Maharashtra",...t})}),(0,s.jsx)(x.C5,{})]})}}),(0,s.jsx)(x.zB,{control:C.control,name:"pincode",render:e=>{let{field:t}=e;return(0,s.jsxs)(x.eI,{children:[(0,s.jsx)(x.lR,{children:"PIN Code"}),(0,s.jsx)(x.MJ,{children:(0,s.jsx)(m.p,{placeholder:"6-digit PIN code",...t})}),(0,s.jsx)(x.C5,{})]})}})]}),(0,s.jsxs)(u.$,{type:"submit",disabled:S,className:"w-full",size:"lg",children:[S?(0,s.jsx)(g.G,{size:20,className:"mr-2"}):null,"Place Order (Cash on Delivery)"]})]})})})]})}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)(f.Zp,{className:"shadow-lg rounded-xl sticky top-20",children:[(0,s.jsxs)(f.aR,{children:[(0,s.jsx)(f.ZB,{children:"Your Order"}),(0,s.jsx)(f.BT,{children:"A summary of items in your cart."})]}),(0,s.jsxs)(f.Wu,{className:"space-y-4 max-h-[50vh] overflow-y-auto",children:[v.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 border-b pb-2 last:border-none",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(j.default,{src:e.imageUrl,alt:e.name,width:60,height:60,className:"rounded-md object-cover"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-sm line-clamp-1",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Qty: ",e.quantity]})]})]}),(0,s.jsxs)("p",{className:"font-medium text-sm",children:["₹",(e.price*e.quantity).toFixed(2)]})]},e.id)),(0,s.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsxs)("span",{children:["₹",N.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,s.jsx)("span",{children:"Shipping"}),(0,s.jsx)("span",{className:"font-medium text-primary",children:"Free"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,s.jsx)("span",{children:"Total"}),(0,s.jsxs)("span",{children:["₹",N.toFixed(2)]})]})]})]})]})})]})]})}},35695:(e,t,r)=>{"use strict";var s=r(18999);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},40283:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>u});var s=r(95155),a=r(12115),l=r(93004),n=r(80544),i=r(56631),d=r(46339);let o=(0,a.createContext)(void 0),c=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},u=e=>{let{children:t}=e,[r,c]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[f,x]=(0,a.useState)(!0);(0,a.useEffect)(()=>{console.log("AuthContext: Subscribing to auth state changes.");let e=(0,l.hg)(n.j2,async e=>{if(x(!0),c(e),e)try{console.log("AuthContext: User ".concat(e.uid," authenticated. Fetching profile..."));let t=await (0,i.VM)(e.uid);m(t),console.log("AuthContext: User profile fetched successfully:",t)}catch(t){console.error("AuthContext: Failed to fetch user profile for UID:",e.uid,"Error:",t),m(null)}finally{x(!1),console.log("AuthContext: Loading finished for authenticated user.")}else m(null),x(!1),console.log("AuthContext: No user authenticated or user logged out. Loading finished.")});return()=>{console.log("AuthContext: Unsubscribing from auth state changes."),e()}},[]);let p=async()=>{await n.j2.signOut()};return f?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-background",children:[(0,s.jsx)(d.G,{size:64}),(0,s.jsx)("p",{className:"mt-4 text-lg text-muted-foreground",children:"Initializing Session..."})]}):(0,s.jsx)(o.Provider,{value:{currentUser:r,userProfile:u,loading:f,logout:p},children:t})}},41654:(e,t,r)=>{Promise.resolve().then(r.bind(r,29301))},46339:(e,t,r)=>{"use strict";r.d(t,{G:()=>n});var s=r(95155),a=r(53838),l=r(59434);let n=e=>{let{className:t,size:r=24}=e;return(0,s.jsx)(a.A,{size:r,className:(0,l.cn)("animate-grow-and-sway text-primary",t)})}},56631:(e,t,r)=>{"use strict";r.d(t,{G6:()=>d,VM:()=>c,WZ:()=>n,mu:()=>i});var s=r(93004),a=r(80544),l=r(35317);let n=async(e,t,r)=>{let l=await (0,s.eJ)(a.j2,e,t);return await (0,s.r7)(l.user,{displayName:r}),await o(l.user),l},i=async(e,t)=>(0,s.x9)(a.j2,e,t),d=async()=>{let e=new s.HF;try{let t=await (0,s.df)(a.j2,e);return t.user&&await o(t.user),t}catch(e){throw console.error("Error during Google sign-in:",e),e}},o=async e=>{if(!e)return;let t=(0,l.H9)(a.db,"users/".concat(e.uid)),r=await (0,l.x7)(t);if(r.exists()){let s=r.data(),a={};if(e.photoURL&&s.photoURL!==e.photoURL&&(a.photoURL=e.photoURL),e.displayName&&s.displayName!==e.displayName&&(a.displayName=e.displayName),Object.keys(a).length>0)try{await (0,l.mZ)(t,a)}catch(e){console.error("Error updating user profile on sign-in",e)}}else{let{email:r,displayName:s,uid:n,photoURL:i}=e,d=new Date().toISOString(),o=(0,l.rJ)(a.db,"users"),c=(0,l.P)(o,(0,l.AB)(1)),u=(await (0,l.GG)(c)).empty;try{await (0,l.BN)(t,{uid:n,email:r,displayName:s||(null==r?void 0:r.split("@")[0])||"User",photoURL:i||null,createdAt:d,role:u?"admin":"farmer",status:"active"})}catch(e){throw console.error("Error creating user document",e),e}}return t},c=async e=>{let t=(0,l.H9)(a.db,"users/".concat(e)),r=await (0,l.x7)(t);if(r.exists()){var s;let t=r.data(),a=(null==(s=t.createdAt)?void 0:s.toDate)?t.createdAt.toDate().toISOString():t.createdAt;return{...t,uid:e,createdAt:a}}return null}},62523:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(95155),a=r(12115),l=r(59434);let n=a.forwardRef((e,t)=>{let{className:r,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},66695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i,wL:()=>u});var s=r(95155),a=r(12115),l=r(59434);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-xl hover:-translate-y-1",r),...a})});n.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});d.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",r),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},85057:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});var s=r(95155),a=r(12115),l=r(40968),n=r(74466),i=r(59434);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(l.b,{ref:t,className:(0,i.cn)(d(),r),...a})});o.displayName=l.b.displayName},87481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var s=r(12115);let a=0,l=new Map,n=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],o={toasts:[]};function c(e){o=i(o,e),d.forEach(e=>{e(o)})}function u(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||s()}}}),{id:r,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=s.useState(o);return s.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,668,3340,6766,5302,7124,8441,1684,7358],()=>t(41654)),_N_E=e.O()}]);