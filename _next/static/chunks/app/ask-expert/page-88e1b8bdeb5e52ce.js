(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7287],{31949:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},57804:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(40157).A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])},73672:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(40157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},83831:(e,r,t)=>{Promise.resolve().then(t.bind(t,88823))},88823:(e,r,t)=>{"use strict";t.d(r,{default:()=>E});var s=t(95155),a=t(12115),i=t(66766),l=t(62177),n=t(90221),o=t(55594),d=t(30285),c=t(62523),u=t(88539),h=t(66695),m=t(55365),x=t(58127),p=t(57804),f=t(31949),y=t(73672),j=t(91840),g=t(17759),w=t(40283),b=t(87481),v=t(90858),N=t(80544);let k=async(e,r)=>{if(!e)throw Error("No file provided for upload.");if(!r)throw Error("User ID is required for upload.");let t="diagnoses/".concat(r,"/").concat(Date.now(),"-").concat(e.name),s=(0,v.KR)(N.IG,t);try{let r=await (0,v.D)(s,e);return await (0,v.qk)(r.ref)}catch(e){throw console.error("Error uploading image to Firebase Storage:",e),Error("Failed to upload image.")}};var A=t(46339);let S=o.Ik({image:o.Ie(e=>e instanceof FileList&&e.length>0,"Please upload an image of the crop."),description:o.Yj().min(10,"Please provide a detailed description of at least 10 characters.").max(500,"Description must be 500 characters or less.")});function E(){let[e,r]=(0,a.useState)(!1),[t,o]=(0,a.useState)(null),[v,N]=(0,a.useState)(!1),[E,q]=(0,a.useState)(null),{currentUser:C}=(0,w.A)(),{toast:P}=(0,b.dj)(),R=(0,l.mN)({resolver:(0,n.u)(S),defaultValues:{description:""}}),D=e=>{var r;let t=null==(r=e.target.files)?void 0:r[0];if(t){let r=new FileReader;r.onloadend=()=>{q(r.result)},r.readAsDataURL(t),R.setValue("image",e.target.files)}else q(null)},F=async e=>{if(r(!0),o(null),N(!1),!C){o("You must be logged in to ask an expert."),r(!1),P({variant:"destructive",title:"Authentication Required",description:"Please log in to submit a query."});return}try{let r=e.image[0],t=await k(r,C.uid),a=await (0,j.sA)({photoURL:t,description:e.description},C.uid);a.success?(N(!0),P({title:"Query Submitted Successfully",description:"An expert will review your query. You will be notified of their response.",action:(0,s.jsx)(x.A,{className:"text-green-500"})}),R.reset(),q(null)):o(a.error||"Failed to submit query. Please try again.")}catch(e){o(e instanceof Error?e.message:"An unexpected error occurred. Please try again."),console.error(e)}finally{r(!1)}};return(0,s.jsx)("div",{className:"max-w-xl mx-auto",children:v?(0,s.jsxs)(h.Zp,{className:"shadow-xl rounded-xl text-center",children:[(0,s.jsxs)(h.aR,{children:[(0,s.jsx)(x.A,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,s.jsx)(h.ZB,{children:"Query Sent!"})]}),(0,s.jsx)(h.Wu,{children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Your query has been successfully submitted to our experts. They will review it and you will receive a notification once they respond. You can check the status in your diagnosis history."})}),(0,s.jsx)(h.wL,{children:(0,s.jsx)(d.$,{onClick:()=>N(!1),className:"w-full",children:"Submit Another Query"})})]}):(0,s.jsx)(g.lV,{...R,children:(0,s.jsxs)(h.Zp,{className:"shadow-xl rounded-xl",children:[(0,s.jsxs)(h.aR,{children:[(0,s.jsxs)(h.ZB,{className:"flex items-center gap-2 text-2xl",children:[(0,s.jsx)(p.A,{className:"text-primary"})," Submit Query to Expert"]}),(0,s.jsx)(h.BT,{children:"Provide an image and a detailed description of the issue. Login required."})]}),(0,s.jsxs)("form",{onSubmit:R.handleSubmit(F),children:[(0,s.jsxs)(h.Wu,{className:"space-y-6",children:[(0,s.jsx)(g.zB,{control:R.control,name:"image",render:r=>{let{field:t}=r;return(0,s.jsxs)(g.eI,{children:[(0,s.jsx)(g.lR,{children:"Crop Image"}),(0,s.jsx)(g.MJ,{children:(0,s.jsx)(c.p,{type:"file",accept:"image/*",onChange:D,className:"file:text-sm file:font-medium file:bg-primary/10 file:text-primary file:border-0 file:rounded-md file:px-3 file:py-1.5 hover:file:bg-primary/20",disabled:!C||e})}),(0,s.jsx)(g.C5,{})]})}}),E&&(0,s.jsx)("div",{className:"mt-4 border rounded-lg overflow-hidden aspect-video relative w-full max-w-md mx-auto",children:(0,s.jsx)(i.default,{src:E,alt:"Crop preview",layout:"fill",objectFit:"contain","data-ai-hint":"leaf plant"})}),(0,s.jsx)(g.zB,{control:R.control,name:"description",render:r=>{let{field:t}=r;return(0,s.jsxs)(g.eI,{children:[(0,s.jsx)(g.lR,{children:"Detailed Description of Problem"}),(0,s.jsx)(g.MJ,{children:(0,s.jsx)(u.T,{placeholder:"e.g., The leaves are turning yellow with brown spots, starting from the edges. The problem started about a week ago...",...t,rows:6,disabled:!C||e})}),(0,s.jsx)(g.C5,{})]})}}),t&&(0,s.jsxs)(m.Fc,{variant:"destructive",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),(0,s.jsx)(m.XL,{children:"Submission Error"}),(0,s.jsx)(m.TN,{children:t})]})]}),(0,s.jsx)(h.wL,{children:(0,s.jsxs)(d.$,{type:"submit",disabled:!C||e,className:"w-full",children:[e?(0,s.jsx)(A.G,{size:16,className:"mr-2"}):(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Send Query to Expert"]})})]})]})})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[2992,3644,668,3340,6766,5302,7124,4084,8441,1684,7358],()=>r(83831)),_N_E=e.O()}]);