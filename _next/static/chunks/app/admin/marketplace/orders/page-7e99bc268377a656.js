(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1590],{26126:(e,t,r)=>{"use strict";r.d(t,{E:()=>d});var s=r(95155);r(12115);var a=r(74466),n=r(59434);let l=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:t,variant:r,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:r}),t),...a})}},34181:(e,t,r)=>{Promise.resolve().then(r.bind(r,87191))},40283:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>u});var s=r(95155),a=r(12115),n=r(93004),l=r(80544),d=r(56631),i=r(46339);let o=(0,a.createContext)(void 0),c=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},u=e=>{let{children:t}=e,[r,c]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[x,f]=(0,a.useState)(!0);(0,a.useEffect)(()=>{console.log("AuthContext: Subscribing to auth state changes.");let e=(0,n.hg)(l.j2,async e=>{if(f(!0),c(e),e)try{console.log("AuthContext: User ".concat(e.uid," authenticated. Fetching profile..."));let t=await (0,d.VM)(e.uid);m(t),console.log("AuthContext: User profile fetched successfully:",t)}catch(t){console.error("AuthContext: Failed to fetch user profile for UID:",e.uid,"Error:",t),m(null)}finally{f(!1),console.log("AuthContext: Loading finished for authenticated user.")}else m(null),f(!1),console.log("AuthContext: No user authenticated or user logged out. Loading finished.")});return()=>{console.log("AuthContext: Unsubscribing from auth state changes."),e()}},[]);let h=async()=>{await l.j2.signOut()};return x?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-background",children:[(0,s.jsx)(i.G,{size:64}),(0,s.jsx)("p",{className:"mt-4 text-lg text-muted-foreground",children:"Initializing Session..."})]}):(0,s.jsx)(o.Provider,{value:{currentUser:r,userProfile:u,loading:x,logout:h},children:t})}},46339:(e,t,r)=>{"use strict";r.d(t,{G:()=>l});var s=r(95155),a=r(53838),n=r(59434);let l=e=>{let{className:t,size:r=24}=e;return(0,s.jsx)(a.A,{size:r,className:(0,n.cn)("animate-grow-and-sway text-primary",t)})}},55365:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>i,TN:()=>c,XL:()=>o});var s=r(95155),a=r(12115),n=r(74466),l=r(59434);let d=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=a.forwardRef((e,t)=>{let{className:r,variant:a,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(d({variant:a}),r),...n})});i.displayName="Alert";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})});o.displayName="AlertTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",r),...a})});c.displayName="AlertDescription"},56631:(e,t,r)=>{"use strict";r.d(t,{G6:()=>i,VM:()=>c,WZ:()=>l,mu:()=>d});var s=r(93004),a=r(80544),n=r(35317);let l=async(e,t,r)=>{let n=await (0,s.eJ)(a.j2,e,t);return await (0,s.r7)(n.user,{displayName:r}),await o(n.user),n},d=async(e,t)=>(0,s.x9)(a.j2,e,t),i=async()=>{let e=new s.HF;try{let t=await (0,s.df)(a.j2,e);return t.user&&await o(t.user),t}catch(e){throw console.error("Error during Google sign-in:",e),e}},o=async e=>{if(!e)return;let t=(0,n.H9)(a.db,"users/".concat(e.uid)),r=await (0,n.x7)(t);if(r.exists()){let s=r.data(),a={};if(e.photoURL&&s.photoURL!==e.photoURL&&(a.photoURL=e.photoURL),e.displayName&&s.displayName!==e.displayName&&(a.displayName=e.displayName),Object.keys(a).length>0)try{await (0,n.mZ)(t,a)}catch(e){console.error("Error updating user profile on sign-in",e)}}else{let{email:r,displayName:s,uid:l,photoURL:d}=e,i=new Date().toISOString(),o=(0,n.rJ)(a.db,"users"),c=(0,n.P)(o,(0,n.AB)(1)),u=(await (0,n.GG)(c)).empty;try{await (0,n.BN)(t,{uid:l,email:r,displayName:s||(null==r?void 0:r.split("@")[0])||"User",photoURL:d||null,createdAt:i,role:u?"admin":"farmer",status:"active"})}catch(e){throw console.error("Error creating user document",e),e}}return t},c=async e=>{let t=(0,n.H9)(a.db,"users/".concat(e)),r=await (0,n.x7)(t);if(r.exists()){var s;let t=r.data(),a=(null==(s=t.createdAt)?void 0:s.toDate)?t.createdAt.toDate().toISOString():t.createdAt;return{...t,uid:e,createdAt:a}}return null}},66695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>i,Zp:()=>l,aR:()=>d,wL:()=>u});var s=r(95155),a=r(12115),n=r(59434);let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-xl hover:-translate-y-1",r),...a})});l.displayName="Card";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});d.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});i.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},85127:(e,t,r)=>{"use strict";r.d(t,{A0:()=>d,BF:()=>i,Hj:()=>o,XI:()=>l,nA:()=>u,nd:()=>c,r6:()=>m});var s=r(95155),a=r(12115),n=r(59434);let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",r),...a})})});l.displayName="Table";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",r),...a})});d.displayName="TableHeader";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",r),...a})});i.displayName="TableBody",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...a})}).displayName="TableFooter";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a})});o.displayName="TableRow";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a})});c.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a})});u.displayName="TableCell";let m=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",r),...a})});m.displayName="TableCaption"},87191:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>I});var s=r(95155),a=r(40283),n=r(35695),l=r(12115),d=r(66695),i=r(30285),o=r(6874),c=r.n(o),u=r(28044),m=r(91462),x=r(91840),f=r(87481),h=r(85127),p=r(31949),g=r(59966),j=r(94579),N=r(55365),v=r(26126),y=r(90498),w=r(23478),b=r(79556),A=r(59434);let T=w.bL,S=l.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(w.q7,{ref:t,className:(0,A.cn)("border-b",r),...a})});S.displayName="AccordionItem";let R=l.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsx)(w.Y9,{className:"flex",children:(0,s.jsxs)(w.l9,{ref:t,className:(0,A.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",r),...n,children:[a,(0,s.jsx)(b.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});R.displayName=w.l9.displayName;let C=l.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsx)(w.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,s.jsx)("div",{className:(0,A.cn)("pb-4 pt-0",r),children:a})})});C.displayName=w.UC.displayName;var E=r(46339);function O(e){let{adminUserId:t}=e,[r,a]=(0,l.useState)([]),[n,d]=(0,l.useState)(!0),[o,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(null),{toast:w}=(0,f.dj)(),b=async()=>{d(!0),m(null);let e=await (0,x.np)(t);e.orders?a(e.orders):(m(e.error||"Failed to fetch pending orders."),w({variant:"destructive",title:"Error",description:e.error||"Could not load orders."})),d(!1)};(0,l.useEffect)(()=>{b()},[t]);let A=async e=>{c(e);let r=await (0,x.IJ)(t,e,"approved");r.success?(w({title:"Success",description:"Order has been approved."}),b()):w({variant:"destructive",title:"Error",description:r.error||"Failed to approve order."}),c(null)};return n?(0,s.jsxs)("div",{className:"flex items-center justify-center py-10",children:[(0,s.jsx)(E.G,{size:32}),(0,s.jsx)("p",{className:"ml-2 text-muted-foreground",children:"Loading pending orders..."})]}):u?(0,s.jsxs)(N.Fc,{variant:"destructive",children:[(0,s.jsx)(p.A,{className:"h-4 w-4"}),(0,s.jsx)(N.XL,{children:"Failed to load orders"}),(0,s.jsx)(N.TN,{children:u})]}):0===r.length?(0,s.jsxs)("div",{className:"text-center py-10",children:[(0,s.jsx)(g.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-xl font-semibold text-muted-foreground",children:"No pending orders."}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"All new orders have been processed."})]}):(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(h.XI,{children:[(0,s.jsx)(h.r6,{children:"List of new orders awaiting approval."}),(0,s.jsx)(h.A0,{children:(0,s.jsxs)(h.Hj,{children:[(0,s.jsx)(h.nd,{children:"Order Details"}),(0,s.jsx)(h.nd,{children:"Customer"}),(0,s.jsx)(h.nd,{children:"Total"}),(0,s.jsx)(h.nd,{className:"text-right w-[150px]",children:"Actions"})]})}),(0,s.jsx)(h.BF,{children:r.map(e=>(0,s.jsxs)(h.Hj,{children:[(0,s.jsxs)(h.nA,{children:[(0,s.jsxs)("div",{className:"font-medium",children:["Order #",e.id.substring(0,7),"..."]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.createdAt?(0,y.m)(new Date(e.createdAt),{addSuffix:!0}):"Unknown date"}),(0,s.jsx)(T,{type:"single",collapsible:!0,className:"w-full mt-2",children:(0,s.jsxs)(S,{value:"item-1",children:[(0,s.jsx)(R,{className:"text-xs py-1",children:"View Details"}),(0,s.jsx)(C,{children:(0,s.jsxs)("div",{className:"space-y-2 text-xs p-2 bg-muted/50 rounded-md",children:[(0,s.jsx)("strong",{children:"Shipping to:"}),(0,s.jsx)("p",{children:e.shippingAddress.fullName}),(0,s.jsx)("p",{children:e.shippingAddress.addressLine1}),e.shippingAddress.addressLine2&&(0,s.jsx)("p",{children:e.shippingAddress.addressLine2}),(0,s.jsxs)("p",{children:[e.shippingAddress.city,", ",e.shippingAddress.state," - ",e.shippingAddress.pincode]}),(0,s.jsxs)("p",{children:["Phone: ",e.shippingAddress.phone]}),(0,s.jsx)("hr",{className:"my-2"}),(0,s.jsx)("strong",{children:"Items:"}),(0,s.jsx)("ul",{className:"list-disc pl-4",children:e.items.map(e=>(0,s.jsxs)("li",{children:[e.name," (Qty: ",e.quantity,")"]},e.id))})]})})]})})]}),(0,s.jsx)(h.nA,{className:"text-xs",children:e.shippingAddress.fullName}),(0,s.jsx)(h.nA,{children:(0,s.jsxs)(v.E,{variant:"secondary",children:["₹",e.totalAmount.toFixed(2)]})}),(0,s.jsx)(h.nA,{className:"text-right",children:(0,s.jsxs)(i.$,{variant:"default",size:"sm",onClick:()=>A(e.id),disabled:o===e.id,children:[o===e.id?(0,s.jsx)(E.G,{size:16,className:"mr-2"}):(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"Approve"]})})]},e.id))})]})})}function I(){let{userProfile:e,loading:t,currentUser:r}=(0,a.A)(),o=(0,n.useRouter)();return((0,l.useEffect)(()=>{t||(null==e?void 0:e.role)==="admin"||o.push("/")},[e,t,o]),t)?(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 text-center flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:[(0,s.jsx)(E.G,{size:48,className:"mb-4"}),"Loading order management..."]}):(null==e?void 0:e.role)!=="admin"?(0,s.jsx)("div",{className:"container mx-auto py-12 px-4 flex flex-col items-center justify-center min-h-[calc(100vh-10rem)]",children:(0,s.jsxs)(d.Zp,{className:"w-full max-w-md text-center shadow-xl rounded-xl",children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(u.A,{className:"h-16 w-16 text-destructive mx-auto mb-4"}),(0,s.jsx)(d.ZB,{className:"text-2xl",children:"Access Denied"})]}),(0,s.jsxs)(d.Wu,{children:[(0,s.jsx)(d.BT,{className:"text-lg",children:"This area is restricted to administrators."}),(0,s.jsx)(i.$,{asChild:!0,className:"mt-6",children:(0,s.jsx)(c(),{href:"/",children:"Go to Homepage"})})]})]})}):(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,s.jsxs)("header",{className:"mb-8",children:[(0,s.jsx)(c(),{href:"/admin",className:"text-sm text-primary hover:underline inline-flex items-center mb-4",children:"← Back to Admin Dashboard"}),(0,s.jsxs)("h1",{className:"text-4xl font-headline flex items-center gap-3",children:[(0,s.jsx)(m.A,{className:"h-10 w-10 text-primary"})," Manage New Orders"]}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Review and approve new customer orders before they are shipped."})]}),(0,s.jsxs)(d.Zp,{className:"shadow-lg rounded-xl",children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(d.ZB,{children:"Pending Orders"}),(0,s.jsx)(d.BT,{children:"New orders with status 'Placed' are shown here."})]}),(0,s.jsx)(d.Wu,{children:r&&(0,s.jsx)(O,{adminUserId:r.uid})})]})]})}},87481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var s=r(12115);let a=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},d=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?l(r):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],o={toasts:[]};function c(e){o=d(o,e),i.forEach(e=>{e(o)})}function u(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||s()}}}),{id:r,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=s.useState(o);return s.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,668,3340,6874,3446,2528,1457,7124,8441,1684,7358],()=>t(34181)),_N_E=e.O()}]);