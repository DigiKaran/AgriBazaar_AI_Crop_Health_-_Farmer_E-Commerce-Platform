(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7678],{26038:(e,t,r)=>{Promise.resolve().then(r.bind(r,46472))},40283:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>u});var s=r(95155),a=r(12115),n=r(93004),l=r(80544),o=r(56631),i=r(46339);let d=(0,a.createContext)(void 0),c=()=>{let e=(0,a.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},u=e=>{let{children:t}=e,[r,c]=(0,a.useState)(null),[u,f]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0);(0,a.useEffect)(()=>{console.log("AuthContext: Subscribing to auth state changes.");let e=(0,n.hg)(l.j2,async e=>{if(x(!0),c(e),e)try{console.log("AuthContext: User ".concat(e.uid," authenticated. Fetching profile..."));let t=await (0,o.VM)(e.uid);f(t),console.log("AuthContext: User profile fetched successfully:",t)}catch(t){console.error("AuthContext: Failed to fetch user profile for UID:",e.uid,"Error:",t),f(null)}finally{x(!1),console.log("AuthContext: Loading finished for authenticated user.")}else f(null),x(!1),console.log("AuthContext: No user authenticated or user logged out. Loading finished.")});return()=>{console.log("AuthContext: Unsubscribing from auth state changes."),e()}},[]);let h=async()=>{await l.j2.signOut()};return m?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-background",children:[(0,s.jsx)(i.G,{size:64}),(0,s.jsx)("p",{className:"mt-4 text-lg text-muted-foreground",children:"Initializing Session..."})]}):(0,s.jsx)(d.Provider,{value:{currentUser:r,userProfile:u,loading:m,logout:h},children:t})}},46339:(e,t,r)=>{"use strict";r.d(t,{G:()=>l});var s=r(95155),a=r(53838),n=r(59434);let l=e=>{let{className:t,size:r=24}=e;return(0,s.jsx)(a.A,{size:r,className:(0,n.cn)("animate-grow-and-sway text-primary",t)})}},46472:(e,t,r)=>{"use strict";r.d(t,{default:()=>j});var s=r(95155),a=r(12115),n=r(62523),l=r(30285),o=r(47655),i=r(59434);let d=a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(o.bL,{ref:t,className:(0,i.cn)("relative overflow-hidden",r),...n,children:[(0,s.jsx)(o.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,s.jsx)(c,{}),(0,s.jsx)(o.OK,{})]})});d.displayName=o.bL.displayName;let c=a.forwardRef((e,t)=>{let{className:r,orientation:a="vertical",...n}=e;return(0,s.jsx)(o.VM,{ref:t,orientation:a,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,s.jsx)(o.lr,{className:"relative flex-1 rounded-full bg-border"})})});c.displayName=o.VM.displayName;var u=r(91394),f=r(31949),m=r(91721),x=r(73503),h=r(73672),p=r(40283),g=r(41589),b=r(91840),v=r(87481),w=r(55365),y=r(88240),N=r(84823);function j(){let[e,t]=(0,a.useState)([]),[r,o]=(0,a.useState)(""),[c,j]=(0,a.useState)(!1),[A,S]=(0,a.useState)(""),T=(0,a.useRef)(null),{currentUser:E}=(0,p.A)(),{toast:D}=(0,v.dj)(),{t:O,language:R}=(0,g.o)();(0,a.useEffect)(()=>{E?S("".concat(E.uid,"-").concat(Date.now())):S("guest-".concat(Date.now()))},[E]),(0,a.useEffect)(()=>{if(T.current){let e=T.current.querySelector("div[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}},[e]),(0,a.useEffect)(()=>{t([{id:Date.now().toString(),text:O("chatbot.initialMessage"),sender:"bot",timestamp:new Date}])},[O]);let I=async e=>{if(E&&A)try{await (0,b.ro)({userId:E.uid,sessionId:A,text:e.text,sender:e.sender})}catch(e){console.error("Failed to save chat message:",e)}},_=async s=>{if(s.preventDefault(),!r.trim())return;if(!E)return void D({variant:"destructive",title:"Login Required",description:"Please log in to chat with AgriBot."});let a={text:r,sender:"user"},n={...a,id:Date.now().toString(),timestamp:new Date},l=[...e,n];t(l),o(""),j(!0),await I(a);let i=l.filter(e=>"user"===e.sender||"bot"===e.sender).map(e=>({role:"user"===e.sender?"user":"model",parts:[{text:e.text}]})),d=await (0,b.gC)({message:n.text,history:i.slice(0,-1),language:R}),c="I'm sorry, I encountered an error. Please try again later.";"response"in d?c=d.response:"error"in d&&(c="Error: ".concat(d.error),console.error("AgriBot response error:",d.error));let u={text:c,sender:"bot"},f={...u,id:(Date.now()+1).toString(),timestamp:new Date};t(e=>[...e,f]),j(!1),await I(u)};return(0,s.jsxs)("div",{className:"flex flex-col h-full w-full bg-card border rounded-xl shadow-xl overflow-hidden",children:[!E&&(0,s.jsxs)(w.Fc,{variant:"destructive",className:"m-4 rounded-md",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),(0,s.jsx)(w.XL,{children:O("chatbot.loginToChat")}),(0,s.jsx)(w.TN,{children:O("chatbot.loginToChatDescription")})]}),(0,s.jsx)(d,{className:"flex-grow p-4 sm:p-6",ref:T,children:(0,s.jsxs)("div",{className:"space-y-4",children:[e.map(e=>(0,s.jsxs)("div",{className:(0,i.cn)("flex items-end gap-2 max-w-[85%] sm:max-w-[75%]","user"===e.sender?"ml-auto flex-row-reverse":"mr-auto"),children:[(0,s.jsx)(u.eu,{className:"h-8 w-8",children:"user"===e.sender?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.BK,{src:(null==E?void 0:E.photoURL)||void 0,alt:(null==E?void 0:E.displayName)||"User"}),(0,s.jsx)(u.q5,{className:"bg-accent text-accent-foreground",children:(0,s.jsx)(m.A,{size:18})})]}):(0,s.jsx)(u.q5,{className:"bg-primary text-primary-foreground",children:(0,s.jsx)(x.A,{size:18})})}),(0,s.jsxs)("div",{className:(0,i.cn)("rounded-lg px-3 py-2 text-sm shadow","user"===e.sender?"bg-primary text-primary-foreground rounded-br-none":"bg-secondary text-secondary-foreground rounded-bl-none"),children:["bot"===e.sender?(0,s.jsx)(y.oz,{className:"chat-prose",remarkPlugins:[N.A],children:e.text}):(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:e.text}),(0,s.jsx)("p",{className:(0,i.cn)("text-xs mt-1","user"===e.sender?"text-primary-foreground/70 text-right":"text-secondary-foreground/70 text-left"),children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)),c&&(0,s.jsxs)("div",{className:"flex items-end gap-2 max-w-[75%] mr-auto",children:[(0,s.jsx)(u.eu,{className:"h-8 w-8",children:(0,s.jsx)(u.q5,{className:"bg-primary text-primary-foreground",children:(0,s.jsx)(x.A,{size:18})})}),(0,s.jsx)("div",{className:"rounded-lg px-3 py-2 text-sm shadow bg-secondary text-secondary-foreground rounded-bl-none",children:(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("span",{className:"h-2 w-2 bg-muted-foreground rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,s.jsx)("span",{className:"h-2 w-2 bg-muted-foreground rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,s.jsx)("span",{className:"h-2 w-2 bg-muted-foreground rounded-full animate-bounce"})]})})]})]})}),(0,s.jsxs)("form",{onSubmit:_,className:"flex items-center gap-2 border-t p-4 bg-background",children:[(0,s.jsx)(n.p,{type:"text",placeholder:E?O("chatbot.inputPlaceholder"):O("chatbot.inputPlaceholderLoggedOut"),value:r,onChange:e=>o(e.target.value),className:"flex-grow",disabled:c||!E}),(0,s.jsxs)(l.$,{type:"submit",size:"icon",disabled:c||!r.trim()||!E,className:"bg-accent hover:bg-accent/90 text-accent-foreground",children:[(0,s.jsx)(h.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"sr-only",children:O("chatbot.send")})]})]})]})}},55365:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>i,TN:()=>c,XL:()=>d});var s=r(95155),a=r(12115),n=r(74466),l=r(59434);let o=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=a.forwardRef((e,t)=>{let{className:r,variant:a,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(o({variant:a}),r),...n})});i.displayName="Alert";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})});d.displayName="AlertTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",r),...a})});c.displayName="AlertDescription"},56631:(e,t,r)=>{"use strict";r.d(t,{G6:()=>i,VM:()=>c,WZ:()=>l,mu:()=>o});var s=r(93004),a=r(80544),n=r(35317);let l=async(e,t,r)=>{let n=await (0,s.eJ)(a.j2,e,t);return await (0,s.r7)(n.user,{displayName:r}),await d(n.user),n},o=async(e,t)=>(0,s.x9)(a.j2,e,t),i=async()=>{let e=new s.HF;try{let t=await (0,s.df)(a.j2,e);return t.user&&await d(t.user),t}catch(e){throw console.error("Error during Google sign-in:",e),e}},d=async e=>{if(!e)return;let t=(0,n.H9)(a.db,"users/".concat(e.uid)),r=await (0,n.x7)(t);if(r.exists()){let s=r.data(),a={};if(e.photoURL&&s.photoURL!==e.photoURL&&(a.photoURL=e.photoURL),e.displayName&&s.displayName!==e.displayName&&(a.displayName=e.displayName),Object.keys(a).length>0)try{await (0,n.mZ)(t,a)}catch(e){console.error("Error updating user profile on sign-in",e)}}else{let{email:r,displayName:s,uid:l,photoURL:o}=e,i=new Date().toISOString(),d=(0,n.rJ)(a.db,"users"),c=(0,n.P)(d,(0,n.AB)(1)),u=(await (0,n.GG)(c)).empty;try{await (0,n.BN)(t,{uid:l,email:r,displayName:s||(null==r?void 0:r.split("@")[0])||"User",photoURL:o||null,createdAt:i,role:u?"admin":"farmer",status:"active"})}catch(e){throw console.error("Error creating user document",e),e}}return t},c=async e=>{let t=(0,n.H9)(a.db,"users/".concat(e)),r=await (0,n.x7)(t);if(r.exists()){var s;let t=r.data(),a=(null==(s=t.createdAt)?void 0:s.toDate)?t.createdAt.toDate().toISOString():t.createdAt;return{...t,uid:e,createdAt:a}}return null}},62523:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var s=r(95155),a=r(12115),n=r(59434);let l=a.forwardRef((e,t)=>{let{className:r,type:a,...l}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...l})});l.displayName="Input"},87481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>f});var s=r(12115);let a=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?l(r):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],d={toasts:[]};function c(e){d=o(d,e),i.forEach(e=>{e(d)})}function u(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||s()}}}),{id:r,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=s.useState(d);return s.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},91394:(e,t,r)=>{"use strict";r.d(t,{BK:()=>i,eu:()=>o,q5:()=>d});var s=r(95155),a=r(12115),n=r(85977),l=r(59434);let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.bL,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...a})});o.displayName=n.bL.displayName;let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n._V,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",r),...a})});i.displayName=n._V.displayName;let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.H4,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...a})});d.displayName=n.H4.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,668,3340,7446,2241,7124,1589,8441,1684,7358],()=>t(26038)),_N_E=e.O()}]);